# 2. Hello World !!!

curses の世界へようこそ。ライブラリに入り込み、そのさまざまな機能を調べる前に、簡単なプログラムを書いて、世界にこんにちはと言いましょう。

## 2.1. NCURSES ライブラリを使用してコンパイルする

ncurses ライブラリ関数を使用する為に、プログラムに cl-charms をインストールする必要があります。  
下記コマンドでインストールする事が出来ます。

```
    sbcl
    * (ql:quickload :cl-charms)
```

cl-charms インストール時の注意点として、SBCL, ASDF の二つのバージョンが低い場合、こける事があります。  
SBCL v1.3.13, ASDF v3.1.5 では動作確認済です。

### 例 1. Hello World !!! プログラム

quicklisp でのインストールが出来ていて、asdf もセットアップ済の場合、asdf を require する事で cl-charms も require 可能になります。

```lisp
;; hello_world.lisp

(require :asdf)
(require :cl-charms)

(charms/ll:initscr)
(charms/ll:printw "Hello World !!!")
(charms/ll:refresh)
(charms/ll:getch)
(charms/ll:endwin)
```

実行は下記の通りにコンソールから行ないます。

```
    sbcl --script hello_world.lisp
```

## 2.2. 分解

上記のプログラムは、"Hello World !!!" と画面に表示して終了します。  
このプログラムは curses を初期化し、画面の操作と curses モードを終了する方法を示します。  
行ごとに分解していきましょう。

### 2.2.1 (initscr) について

(initscr) 関数は、curses モードで端末を初期化します。  
いくつかの実装では、画面をクリアして空白の画面を表示します。curses パッケージを使用して画面の操作を行うには、まずこれを呼び出す必要があります。  
この関数は curses システムを初期化し、現在のウィンドウ (stdscr と呼ばれる) とその他のデータ構造にメモリを割り当てます。  
極端な場合、この関数は、cursesライブラリのデータ構造にメモリを割り当てるメモリが不足しているために失敗する可能性があります。

これが終わったらさまざまな初期化を行い、curses 設定をカスタマイズする事ができます。  
これらの詳細については[後述](http://tldp.org/HOWTO/NCURSES-Programming-HOWTO/init.html)します。

### 2.2.2. 奇怪な (refresh)

次の行 printw は "Hello World !!!" という文字列を出力します。  
この関数は現在の (y, x) 座標で stdscr と呼ばれるウィンドウにデータを出力する点を除いて、通常の printf とすべての点で似ています。  
現在の座標は 0,0 であるため、文字列はウィンドウの左隅に印刷されます。

これは私たちに奇怪な (refresh) を持たらします。  
まあ、printw という名前のデータは実際には想像上のウィンドウに書き出されますが、まだ画面上では更新されません。  
printw の仕事は、いくつかのフラグとデータ構造を更新し、stdscr に対応するバッファにデータを書き込むことです。  
これを画面に表示するには、(refresh) を呼び出して curses システムに内容を画面にダンプするように指示する必要があります。

この背後にある考え方は、プログラマが想像上の画面またはウィンドウ上で複数の更新を行い、画面の更新がすべて完了したら更新を行うことができるようにすることです。  
(refresh) はウィンドウをチェックし、変更された部分だけを更新します。  
これにより、パフォーマンスが向上し、柔軟性も向上します。  
しかし、初心者は時折イライラします。 初心者が間違っているのは、(printw) クラスの関数を使って更新した後に (refresh) を呼び出すことを忘れることです。  
私はまだそれを追加することを忘れています:-)

### 2.2.3. (endwin) について

最後に、curses モードを終了することを忘れないでください。  
さもなければ、あなたの端末はプログラムが終了した後に奇妙な動作をするかもしれません。
(endwin) は、cursesサブシステムとそのデータ構造によって取られたメモリを解放し、端末を通常モードにします。  
この関数は、cursesモードが終了した後に呼び出す必要があります。
