# 4. 初期化

curses システムを初期化するには、関数 (initscr) を呼び出さなければならないことが分かりました。  
curses セッションをカスタマイズするためにこの初期化の後に呼び出すことのできる関数があります。
私たちは curses システムに、端末を raw モードに設定したり、色を初期化したり、マウスを初期化するように頼むかもしれません。  
(initscr) の直後に通常呼び出される関数のいくつかについて議論しましょう。

## 4.1. 初期化関数

### 4.2. (raw) and (cbreak)

通常、端末ドライバ (端末用のデバイスドライバ) は、ユーザーが入力した文字を、改行またはキャリッジリターンが発生するまでバッファリングします。  
しかし、ほとんどのプログラムでは、ユーザーが入力するとすぐに文字を利用できるようにする必要があります。  
上記の2つの機能は回線のバッファリングを無効にするために使用されます。  
これら2つの機能の違いは、サスペンド（CTRL-Z）、割り込み、終了（CTRL-C）などの制御文字がプログラムに渡される点にあります。
(raw) モードでは、これらの文字はシグナルを生成せずに直接プログラムに渡されます。  
(cbreak) モードでは、これらの制御文字は端末ドライバによって他の文字として解釈されます。

私は個人的に (raw) を使う方が好きです。  
なぜなら、ユーザーが何をするかを、より詳細に制御できるからです。

## 4.3. (echo) and (noecho)

これらの機能は、ユーザーが端末に入力した文字のエコーを制御します。(noecho) はエコーをオフに切り替えます。  
あなたがこれを欲しくなるのは (getch) などの関数を使用して、ユーザからの入力を受けて、エコーをより詳細に制御したり、不要なエコーを抑制したりするためです。  
ほとんどの対話型プログラムは、初期化時に (noecho) を呼び出し、制御された方法で文字のエコーを行います。  
現在の (y、x) 座標を更新することなく、ウィンドウ内の任意の場所で文字をエコーする柔軟性をプログラマーに提供します。

## 4.4. (keypad)

これは私のお気に入りの初期化関数です。  
(keypad) は F1、F2、矢印キーなどのファンクションキーの読み取りを可能にします。  
ほぼすべてのインタラクティブなプログラムがこれを可能にします。  
矢印キーはユーザーインターフェイスの主要部分です。

## 4.5. (halfdelay)

この関数はあまり頻繁には使用されませんが、時には便利な関数です。  
半遅延モードを有効にするために (halfdelay) が呼び出されます。  
これは入力された文字がすぐにプログラムで使用できるという点で (cbreak) モードに似ています。

## 4.6. その他の初期化関数

curses の動作をカスタマイズするために初期化時に呼び出される関数はいくつもあります。  
それらは上記のように広く使用されていません。適切なところで説明されているものもあります。

## 4.7. 例

これらの関数の使用法を明確にするプログラムを作成しましょう。

### 例 2. 初期化関数使用例

```lisp
(require :asdf)
(require :cl-charms)

(charms/ll:initscr)
(charms/ll:raw)
(charms/ll:keypad charms/ll:*stdscr* charms/ll:TRUE)
(charms/ll:noecho)

(charms/ll:printw (format nil "Type any character to see it in bold~%"))
(let ((ch (charms/ll:getch)))
  (if (= ch (charms/ll:key_fn 1))
      (charms/ll:printw "F1 Key pressed")
      (progn
        (charms/ll:printw "The pressed key is ")
        (charms/ll:attron charms/ll:A_BOLD)
        (charms/ll:printw "%c" :char ch)
        (charms/ll:attroff charms/ll:A_BOLD))))

(charms/ll:refresh)
(charms/ll:getch)
(charms/ll:endwin)
```

このプログラムは自明です。しかし、私はまだ説明されていない機能を使用しました。  
関数 (getch) はユーザーから文字を取得するために使用されます。
入力後に <enter> を避けるためにラインバッファリングを無効にできる点を除いて、通常の (getchar) と同じです。  
[キー管理セクション](11/README.md) で (getch) とキーを読むことについての詳細を調べてください。  
関数 attron と attroff はそれぞれ属性のオンとオフを切り替えるために使用されます。  
この例では、文字を太字で印刷するために使用しました。これらの機能については後で詳しく説明します。
